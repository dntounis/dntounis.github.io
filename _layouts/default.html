<!DOCTYPE html>
<html lang="en">
{% include head.html %}

<head>
    <meta charset="utf-8">
    <title>{{ page.title }} - {{ site.title }}</title>

    <!-- Google Fonts - Serif for body, Sans-serif for headings -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,500;0,8..60,600;1,8..60,400&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css">

    <!-- D3.js for visualizations -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/favicon_v3/apple-touch-icon.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{ '/assets/favicon_v3/favicon-96x96.png' | relative_url }}">
    <link rel="icon" type="image/svg+xml" href="{{ '/assets/favicon_v3/favicon.svg' | relative_url }}">
    <link rel="manifest" href="{{ '/assets/favicon_v3/site.webmanifest' | relative_url }}">
    <link rel="shortcut icon" href="{{ '/assets/favicon_v3/favicon.ico' | relative_url }}">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="{{ page.title | default: site.title }}">
    <meta property="og:description" content="{{ page.description | default: site.description }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    {% if page.image %}
    <meta property="og:image" content="{{ page.image | absolute_url }}">
    {% else %}
    <meta property="og:image" content="{{ '/assets/images/og-default.png' | absolute_url }}">
    {% endif %}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@dimntounis">

    <script src="{{ '/assets/js/main.js' | relative_url }}" defer></script>

    <!-- MathJax Configuration -->
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true,
            processEnvironments: true
        },
        options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        },
        startup: {
            pageReady: () => {
                return MathJax.startup.defaultPageReady().then(() => {
                    document.querySelectorAll('.project-title-link').forEach(el => {
                        MathJax.typesetPromise([el]);
                    });
                });
            }
        }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>

    <script src="{{ '/assets/js/toggle.js' | relative_url }}" defer></script>

    {% if site.google_analytics %}
    {% include analytics.html %}
    {% endif %}
</head>

<body>
    <header class="site-header">
        <nav class="site-nav">
            <a href="{{ '/' | relative_url }}" class="site-title">Dimitris Ntounis</a>
            <button class="menu-toggle" aria-label="Toggle navigation menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links">
                {%- for path in site.header_pages -%}
                    {%- assign my_page = site.pages | where: "path", path | first -%}
                    {%- if my_page.title -%}
                    <div class="nav-item">
                        {% if my_page.title == "CV" %}
                        <a class="page-link {% if page.url == my_page.url %}current{% endif %}"
                           href="{{ site.cv_pdf }}" target="_blank">{{ my_page.title }}</a>
                        {% else %}
                        <a class="page-link {% if page.url == my_page.url %}current{% endif %}"
                           href="{{ my_page.url | relative_url }}">{{ my_page.title }}</a>
                        {% endif %}
                        {% if my_page.submenu %}
                        <div class="dropdown">
                            {% for item in my_page.submenu %}
                            <a href="{{ item.url }}">{{ item.title }}</a>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {%- endif -%}
                {%- endfor -%}
            </div>
        </nav>
    </header>

    <!-- Theme Toggle Button -->
    <div class="theme-toggle">
        <button id="themeToggle" aria-label="Toggle dark mode">
            <svg class="sun-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.65 0-3 1.35-3 3s1.35 3 3 3 3-1.35 3-3-1.35-3-3-3zm0-2c.28 0 .5-.22.5-.5V4c0-.28-.22-.5-.5-.5s-.5.22-.5.5v2.5c0 .28.22.5.5.5zm0 14c-.28 0-.5.22-.5.5V23c0 .28.22.5.5.5s.5-.22.5-.5v-2.5c0-.28-.22-.5-.5-.5z"/>
            </svg>
            <svg class="moon-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
            </svg>
        </button>
    </div>

    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top" aria-label="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <main class="page-content">
        {{ content }}
    </main>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-text">
                &copy; {{ site.time | date: '%Y' }} {{ site.author.name }}, Powered by Jekyll
            </div>
            <div class="footer-update">
                Site last updated {{ site.time | date: '%Y-%m-%d' }}
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        const menuToggle = document.querySelector('.menu-toggle');
        if (menuToggle) {
            menuToggle.addEventListener('click', function() {
                document.querySelector('.nav-links').classList.toggle('active');
                this.classList.toggle('active');
            });
        }

        // Back to top button
        const backToTop = document.getElementById('backToTop');
        if (backToTop) {
            window.addEventListener('scroll', function() {
                if (window.scrollY > 300) {
                    backToTop.classList.add('visible');
                } else {
                    backToTop.classList.remove('visible');
                }
            });
            backToTop.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    </script>
    <script src="{{ '/assets/js/theme.js' | relative_url }}" defer></script>

    <!-- Animated Counter for Metrics -->
    <script>
    (function() {
        const animateCounters = () => {
            const counters = document.querySelectorAll('.metric-value[data-count]');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !entry.target.classList.contains('counted')) {
                        entry.target.classList.add('counted');
                        const target = parseInt(entry.target.dataset.count);
                        const duration = 2000;
                        const startTime = performance.now();

                        const updateCounter = (currentTime) => {
                            const elapsed = currentTime - startTime;
                            const progress = Math.min(elapsed / duration, 1);
                            // Easing function for smooth animation
                            const easeOut = 1 - Math.pow(1 - progress, 3);
                            const current = Math.floor(easeOut * target);
                            entry.target.textContent = current.toLocaleString();

                            if (progress < 1) {
                                requestAnimationFrame(updateCounter);
                            } else {
                                entry.target.textContent = target.toLocaleString();
                            }
                        };
                        requestAnimationFrame(updateCounter);
                    }
                });
            }, { threshold: 0.5 });

            counters.forEach(counter => observer.observe(counter));
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', animateCounters);
        } else {
            animateCounters();
        }
    })();
    </script>
</body>
</html>
